name: Fetch and Save TVBox Raw URLs (å…¨ç½‘ GitHub æœç´¢)

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤© UTC 02:00 è‡ªåŠ¨è¿è¡Œï¼ˆå¯é€‰ï¼‰

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç ï¼ˆå¯ç”¨ git å†å²è®°å½•ï¼Œç”¨äºæäº¤ï¼‰
        uses: actions/checkout@v3
        with:
          ref: main  # æˆ– mergeï¼Œæ ¹æ®æ‚¨çš„åˆ†æ”¯
          token: ${{ secrets.GH_TOKEN }}  # ğŸ‘ˆ ä½¿ç”¨å…·æœ‰å†™å…¥æƒé™çš„ Token
          fetch-depth: 0  # è·å–å…¨éƒ¨å†å²ï¼Œä»¥ä¾¿ git push æ­£å¸¸å·¥ä½œ

      - name: è®¾ç½® Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: å®‰è£…ä¾èµ–
        run: |
          pip install requests

      - name: è¿è¡Œè„šæœ¬ï¼Œç”Ÿæˆ Raw URLs æ–‡ä»¶
        run: |
          python merge/fetch_tvbox_raw_urls.py

      - name: é…ç½® Git ç”¨æˆ·ä¿¡æ¯
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

      - name: æ·»åŠ ã€æäº¤å¹¶æ¨é€ tvbox_raw_sources.txt åˆ° /merge/
        run: |
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ -f "merge/tvbox_raw_sources.txt" ]; then
            git add merge/tvbox_raw_sources.txt
            git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–° TVBox å…¨ç½‘ Raw æºæ–‡ä»¶é“¾æ¥ (å…³é”®è¯ï¼šèç‰‡ã€é‡‡é›†ã€.spider)" || echo "æ— å˜æ›´ï¼Œè·³è¿‡æäº¤"
            git push || echo "æ¨é€å¤±è´¥ï¼Œå¯èƒ½æ— å˜æ›´æˆ–æƒé™é—®é¢˜"
          else
            echo "âš ï¸ tvbox_raw_sources.txt æ–‡ä»¶æœªç”Ÿæˆï¼Œè·³è¿‡æäº¤"
          fi
