name: Fetch and Save TVBox Raw URLs (å…¨ç½‘ GitHub æœç´¢)

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤© UTC 02:00 è‡ªåŠ¨è¿è¡Œï¼ˆå¯é€‰ï¼Œå¯åˆ é™¤ï¼‰

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç ï¼ˆå¸¦å®Œæ•´ Git å†å²ï¼Œç”¨äºæäº¤ï¼‰
        uses: actions/checkout@v3
        with:
          ref: main  # æˆ– mergeï¼Œæ ¹æ®æ‚¨çš„åˆ†æ”¯
          token: ${{ secrets.MY_GH_TOKEN }}  # âœ… ä½¿ç”¨æœ‰å†™å…¥æƒé™çš„ Token
          fetch-depth: 0  # å¿…é¡»æ‹‰å…¨å†å²ï¼Œå¦åˆ™ git push ä¼šå¤±è´¥

      - name: è®¾ç½® Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: å®‰è£…ä¾èµ–
        run: |
          pip install requests

      - name: è¿è¡Œè„šæœ¬ï¼Œç”Ÿæˆ Raw URLs æ–‡ä»¶
        env:
          MY_GH_TOKEN: ${{ secrets.MY_GH_TOKEN }}  # âœ… å…³é”®ï¼šæŠŠ Token ä¼ å…¥è„šæœ¬çš„ç¯å¢ƒå˜é‡
        run: |
          python merge/fetch_tvbox_raw_urls.py

      - name: é…ç½® Git ç”¨æˆ·ä¿¡æ¯
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

      - name: æ·»åŠ ã€æäº¤å¹¶æ¨é€ tvbox_raw_sources.txt åˆ° /merge/
        run: |
          if [ -f "merge/tvbox_raw_sources.txt" ]; then
            git add merge/tvbox_raw_sources.txt
            git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–° TVBox å…¨ç½‘ Raw æºæ–‡ä»¶é“¾æ¥ (å…³é”®è¯ï¼šèç‰‡ã€é‡‡é›†ã€.spider)" || echo "æ— å˜æ›´ï¼Œè·³è¿‡æäº¤"
            git push || echo "æ¨é€å¤±è´¥ï¼Œå¯èƒ½æ— å˜æ›´æˆ–æƒé™é—®é¢˜"
          else
            echo "âš ï¸ tvbox_raw_sources.txt æ–‡ä»¶æœªç”Ÿæˆï¼Œè·³è¿‡æäº¤"
          fi
